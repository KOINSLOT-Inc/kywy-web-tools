<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Drawing Editor - Kywy Image Tools</title>
    <link rel="stylesheet" href="drawing-editor-style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="nav-bar">
                <div class="header-left">
                    <a href="menu.html" class="back-button">‚Üê Back to Menu</a>
                    <div class="brand-section">
                        <div class="ks-icon"></div>
                        <div class="brand-info">
                            <span class="brand-name">KOINSLOT</span>
                            <span class="app-name">Drawing Editor</span>
                        </div>
                    </div>
                </div>
                
                <!-- Desktop Navigation -->
                <div class="nav-actions desktop-nav">
                    <button id="helpBtn" class="nav-btn">‚ùì Help</button>
                    <button id="importImageBtn" class="nav-btn">üñºÔ∏è Import</button>
                    <button id="clearCanvas" class="nav-btn">üóëÔ∏è Clear</button>
                    <button id="undoBtn" class="nav-btn" disabled title="Undo (Ctrl+Z)">‚Ü∂ Undo</button>
                    <button id="redoBtn" class="nav-btn" disabled title="Redo (Ctrl+Y)">‚Ü∑ Redo</button>
                    <button id="newBtn" class="nav-btn">New</button>
                    <button id="saveBtn" class="nav-btn">Save</button>
                    <button id="loadBtn" class="nav-btn">Load</button>
                    <input type="file" id="loadInput" accept=".json" style="display: none;">
                </div>
                
                <!-- Mobile Top Dropdowns -->
                <div class="mobile-top-bar">
                    <div class="mobile-dropdown">
                        <button class="mobile-dropdown-btn" id="mobileMenuDropdown">‚ò∞</button>
                        <div class="mobile-dropdown-content" id="mobileMainMenu">
                            <button id="mobileBackToMenu">üè† Back to Menu</button>
                            <button id="mobileHelpBtn">‚ùì Help</button>
                            <button id="mobileImportBtn">üñºÔ∏è Import</button>
                            <button id="mobileClearBtn">üóëÔ∏è Clear</button>
                            <button id="mobileUndoBtn">‚Ü∂ Undo</button>
                            <button id="mobileRedoBtn">‚Ü∑ Redo</button>
                            <button id="mobileNewBtn">üìÑ New</button>
                            <button id="mobileSaveBtn">üíæ Save</button>
                            <button id="mobileLoadBtn">üìÇ Load</button>
                            <button id="mobileThemeBtn">üé® Theme</button>
                        </div>
                    </div>
                </div>
                
                <!-- Mobile Panel Toggle Buttons -->
                <div class="mobile-panel-toggles">
                    <button class="mobile-panel-toggle" id="mobileToolsToggle">‚óÄ Left</button>
                    <button class="mobile-panel-toggle" id="mobileExportToggle">Right ‚ñ∂</button>
                </div>
            </div>
        </header>

        <div class="editor-layout">
            <!-- Left Sidebar Toggle -->
            <button class="sidebar-toggle left-toggle" id="leftToggle" title="Toggle Tools Panel">
                <span class="arrow">‚óÄ</span>
            </button>
            
            <!-- Left Sidebar - Tools -->
            <aside class="tools-panel" id="toolsPanel">
                <div class="tool-section">
                    <h3>Canvas Size</h3>
                    <select id="canvasSize">
                        <option value="8x8">8√ó8</option>
                        <option value="16x16">16√ó16</option>
                        <option value="32x32">32√ó32</option>
                        <option value="64x64">64√ó64</option>
                        <option value="128x128">128√ó128</option>
                        <option value="144x168" selected>144√ó168 (Kywy)</option>
                        <option value="custom">Custom</option>
                    </select>
                    <div id="customSize" class="custom-size-inputs" style="display: none;">
                        <input type="number" id="customWidth" placeholder="Width" min="1" max="500" value="144">
                        <span>√ó</span>
                        <input type="number" id="customHeight" placeholder="Height" min="1" max="500" value="168">
                        <button id="applyCustomSize">Apply</button>
                    </div>
                </div>

                <div class="tool-group">
                    <h3>Tools</h3>
                    <div class="tools-grid">
                        <button class="tool-btn" data-tool="pen" title="Pen Tool (P)">‚úèÔ∏è Pen</button>
                        <button class="tool-btn" data-tool="hand" title="Pan Tool (H)">‚úã Hand</button>
                        <button class="tool-btn" data-tool="circle" title="Circle Tool (C)">‚≠ï Circle</button>
                        <button class="tool-btn" data-tool="square" title="Rectangle Tool (R)">üü• Rectangle</button>
                        <button class="tool-btn" data-tool="polygon" title="Polygon Tool (G)">‚¨¢ Polygon</button>
                        <button class="tool-btn" data-tool="bucket" title="Bucket Fill (F)">ü™£ Fill</button>
                        <button class="tool-btn" data-tool="text" title="Text Tool (T)">üî§ Text</button>
                        <button class="tool-btn" data-tool="select" title="Select Tool (S)">üî≤ Select</button>
                    </div>
                </div>

                <div class="tool-section" id="brushSettings">
                    <h3>Brush Settings</h3>
                    <label>Size: <span id="brushSizeDisplay">1</span>px</label>
                    <input type="range" id="brushSize" min="1" max="50" value="1">
                    
                    <div id="sprayFlowControl" style="display: none;">
                        <label>Flow: <span id="sprayFlowDisplay">3</span></label>
                        <input type="range" id="sprayFlow" min="1" max="10" value="3">
                    </div>
                    
                    <label>Shape:</label>
                    <div class="brush-shape">
                        <button id="squareBrush" class="brush-shape-btn active" data-shape="square">‚¨ú Square</button>
                        <button id="circleBrush" class="brush-shape-btn" data-shape="circle">‚≠ï Circle</button>
                    </div>
                    
                    <label>Color:</label>
                    <div class="color-picker">
                        <button id="blackColor" class="color-btn active" data-color="black">‚¨õ Black</button>
                        <button id="whiteColor" class="color-btn" data-color="white">‚¨ú White</button>
                    </div>
                    
                    <h4>Pen Mode</h4>
                    <div class="pen-mode-toggle">
                        <button id="penModeBtn" class="shape-mode-btn active" data-mode="freehand">
                            <span id="penModeIcon">‚úèÔ∏è</span>
                            <span id="penModeText">Freehand</span>
                        </button>
                    </div>
                </div>

                <div class="tool-section" id="editSettings" style="display: none;">
                    <h3>Edit</h3>
                    <button id="copyBtn" class="edit-btn">üìã Copy</button>
                    <button id="cutBtn" class="edit-btn">‚úÇÔ∏è Cut</button>
                    <button id="pasteModeBtn" class="edit-btn" disabled>üìã Paste Mode</button>
                    
                    <div id="pasteModeOptions" style="display: none; margin-top: 8px;">
                        <h4>Paste Options</h4>
                        <div style="margin-bottom: 8px;">
                            <label style="display: block; margin-bottom: 4px;">Transparency:</label>
                            <button id="transparencyToggle" class="edit-btn" style="font-size: 12px;">üîç Transparent White</button>
                        </div>
                    </div>
                    
                    <h4>Rotate Selection</h4>
                    <label>Angle: <span id="rotationAngleDisplay">0</span>¬∞</label>
                    <input type="range" id="rotationAngle" min="-180" max="180" value="0" step="15">
                    <div id="rotationWarning" style="display: none; color: #ff6b35; font-size: 11px; margin: 4px 0; padding: 2px 4px; background: rgba(255, 107, 53, 0.1); border-radius: 3px;">
                        ‚ö†Ô∏è Non-90¬∞ rotation is destructive to pixel art
                    </div>
                    <button id="rotateBtn" class="edit-btn">üîÑ Rotate</button>
                    <button id="resetRotationBtn" class="edit-btn">‚Ü∫ Reset</button>
                </div>

                <div class="tool-section" id="bucketSettings" style="display: none;">
                    <h3>Fill Color</h3>
                    <div class="color-picker">
                        <button id="bucketBlackColor" class="color-btn active" data-color="black">‚¨õ Black</button>
                        <button id="bucketWhiteColor" class="color-btn" data-color="white">‚¨ú White</button>
                    </div>
                    
                    <div class="fill-patterns-header">
                        <button id="fillPatternsToggle" class="collapsible-btn">üé® Fill Patterns</button>
                    </div>
                    <div id="fillPatternsSettings" class="frame-controls" style="display: none;">
                        <div class="fill-pattern-tools">
                            <h4>Pattern Type</h4>
                            <div class="pattern-grid">
                                <button class="pattern-btn active" id="solidFill" data-pattern="solid" title="Solid Fill">‚¨õ Solid</button>
                                <button class="pattern-btn" id="percentageFill" data-pattern="percentage" title="Percentage Fill">‚ñ¶ %</button>
                                <button class="pattern-btn" id="checkerboard" data-pattern="checkerboard" title="Checkerboard">‚ñû Check</button>
                                <button class="pattern-btn" id="lines" data-pattern="lines" title="Adjustable Lines">‚â° Lines</button>
                                <button class="pattern-btn" id="clipboardPattern" data-pattern="clipboard" title="Clipboard Pattern">üìã Clip</button>
                                <button class="pattern-btn" id="dots" data-pattern="dots" title="Dot Pattern">‚ãÖ Dots</button>
                            </div>
                            
                            <div class="line-pattern-controls" id="linePatternControls" style="display: none; margin-top: 10px;">
                                <h4>Line Settings</h4>
                                <div class="line-controls">
                                    <div class="control-row">
                                        <label for="lineAngle">Angle:</label>
                                        <input type="range" id="lineAngle" min="0" max="180" value="0" step="15">
                                        <span id="lineAngleDisplay">0¬∞</span>
                                    </div>
                                    <div class="control-row">
                                        <label for="lineSpacing">Spacing:</label>
                                        <input type="range" id="lineSpacing" min="2" max="20" value="6" step="1">
                                        <span id="lineSpacingDisplay">6px</span>
                                    </div>
                                    <div class="control-row">
                                        <label for="lineWidth">Width:</label>
                                        <input type="range" id="lineWidth" min="1" max="5" value="1" step="1">
                                        <span id="lineWidthDisplay">1px</span>
                                    </div>
                                    <div class="control-row">
                                        <label for="linePhase">Phase:</label>
                                        <input type="range" id="linePhase" min="0" max="20" value="0" step="1">
                                        <span id="linePhaseDisplay">0px</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Pattern-specific controls -->
                        <div class="percentage-pattern-controls" id="percentagePatternControls" style="display: none; margin-top: 10px;">
                            <h4>Percentage Settings</h4>
                            <div class="control-row">
                                <label for="percentageFillSlider">Fill Amount: <span id="percentageDisplay">50</span>%</label>
                                <input type="range" id="percentageFillSlider" min="5" max="95" value="50" step="5">
                            </div>
                        </div>

                        <div class="checkerboard-pattern-controls" id="checkerboardPatternControls" style="display: none; margin-top: 10px;">
                            <h4>Checkerboard Settings</h4>
                            <div class="control-row">
                                <label for="checkerboardSize">Size:</label>
                                <input type="range" id="checkerboardSize" min="1" max="8" value="2" step="1">
                                <span id="checkerboardSizeDisplay">2px</span>
                            </div>
                            <div class="control-row">
                                <label>
                                    <input type="checkbox" id="checkerboardInvert"> Invert Pattern
                                </label>
                            </div>
                        </div>

                        <div class="clipboard-pattern-controls" id="clipboardPatternControls" style="display: none; margin-top: 10px;">
                            <h4>Clipboard Settings</h4>
                            <div class="control-row">
                                <label for="clipboardScale">Scale:</label>
                                <input type="range" id="clipboardScale" min="25" max="300" value="100" step="25">
                                <span id="clipboardScaleDisplay">100%</span>
                            </div>
                            <div class="control-row">
                                <label>
                                    <input type="checkbox" id="clipboardInvert"> Invert Pattern
                                </label>
                            </div>
                        </div>

                        <div class="dots-pattern-controls" id="dotsPatternControls" style="display: none; margin-top: 10px;">
                            <h4>Dots Settings</h4>
                            <div class="control-row">
                                <label for="dotsSpacing">Spacing:</label>
                                <input type="range" id="dotsSpacing" min="2" max="16" value="4" step="1">
                                <span id="dotsSpacingDisplay">4px</span>
                            </div>
                            <div class="control-row">
                                <label for="dotsSize">Size:</label>
                                <input type="range" id="dotsSize" min="1" max="4" value="1" step="1">
                                <span id="dotsSizeDisplay">1px</span>
                            </div>
                            <div class="control-row">
                                <label for="dotsOffset">Offset:</label>
                                <input type="range" id="dotsOffset" min="0" max="100" value="50" step="10">
                                <span id="dotsOffsetDisplay">50%</span>
                            </div>
                            <div class="control-row">
                                <label>
                                    <input type="checkbox" id="dotsInvert"> Invert Pattern
                                </label>
                            </div>
                        </div>
                        
                        <div class="gradient-tools">
                            <h4>Gradients</h4>
                            <div class="gradient-grid">
                                <button class="pattern-btn" id="gradientLinear" data-pattern="gradient-linear" title="Linear Gradient">‚ïê Linear</button>
                                <button class="pattern-btn" id="gradientRadial" data-pattern="gradient-radial" title="Radial Gradient">‚óâ Radial</button>
                            </div>
                            
                            <div class="gradient-variant-controls" id="gradientVariantControls" style="display: none; margin-top: 10px;">
                                <h4>Gradient Style</h4>
                                <div class="gradient-grid">
                                    <button class="variant-btn" id="gradientSmooth" data-variant="smooth" title="Smooth Gradient">‚¨ú Smooth</button>
                                    <button class="variant-btn" id="gradientStipple" data-variant="stipple" title="Stippled Gradient">‚ãÖ Stipple</button>
                                    <button class="variant-btn" id="gradientDither" data-variant="dither" title="Dithered Gradient">‚ñ¶ Dither</button>
                                </div>
                            </div>
                            
                            <div class="gradient-controls" id="gradientControls" style="display: none; margin-top: 10px;">
                                <div id="linearControls" style="display: none;">
                                    <h4>Linear Gradient Settings</h4>
                                    <div class="control-row">
                                        <label for="gradientAngle">Angle:</label>
                                        <input type="range" id="gradientAngle" min="0" max="360" value="0" step="15">
                                        <span id="angleDisplay">0¬∞</span>
                                    </div>
                                    <div class="control-row">
                                        <label for="gradientSteepness">Steepness:</label>
                                        <input type="range" id="gradientSteepness" min="0.1" max="5.0" value="1.0" step="0.1">
                                        <span id="steepnessDisplay">1.0</span>
                                    </div>
                                    <div class="control-row">
                                        <label for="gradientPositionX">Position X:</label>
                                        <input type="range" id="gradientPositionX" min="0" max="1" value="0.5" step="0.1">
                                        <span id="positionXDisplay">0.5</span>
                                    </div>
                                    <div class="control-row">
                                        <label for="gradientPositionY">Position Y:</label>
                                        <input type="range" id="gradientPositionY" min="0" max="1" value="0.5" step="0.1">
                                        <span id="positionYDisplay">0.5</span>
                                    </div>
                                </div>
                                
                                <div id="radialControls" style="display: none;">
                                    <h4>Radial Gradient Settings</h4>
                                    <div class="control-row">
                                        <label for="radialRadius">Radius:</label>
                                        <input type="range" id="radialRadius" min="0.1" max="2.0" value="0.7" step="0.1">
                                        <span id="radiusDisplay">0.7</span>
                                    </div>
                                    <div class="control-row">
                                        <label for="radialPositionX">Center X:</label>
                                        <input type="range" id="radialPositionX" min="0" max="1" value="0.5" step="0.1">
                                        <span id="radialXDisplay">0.5</span>
                                    </div>
                                    <div class="control-row">
                                        <label for="radialPositionY">Center Y:</label>
                                        <input type="range" id="radialPositionY" min="0" max="1" value="0.5" step="0.1">
                                        <span id="radialYDisplay">0.5</span>
                                    </div>
                                </div>
                                
                                <div id="stippleDitherControls" style="display: none;">
                                    <h4>Stipple/Dither Settings</h4>
                                    <div class="control-row">
                                        <label for="gradientContrast">Contrast:</label>
                                        <input type="range" id="gradientContrast" min="0.1" max="2.0" value="1.0" step="0.1">
                                        <span id="contrastDisplay">1.0</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tool-section" id="shapeSettings" style="display: none;">
                    <h3>Shape Color</h3>
                    <div class="color-picker">
                        <button id="shapeBlackColor" class="color-btn active" data-color="black">‚¨õ Black</button>
                        <button id="shapeWhiteColor" class="color-btn" data-color="white">‚¨ú White</button>
                    </div>
                    
                    <h4>Fill Style</h4>
                    <div class="fill-style">
                        <button id="outlineOnly" class="fill-btn active" data-fill="outline">‚¨ú Outline</button>
                        <button id="filledShape" class="fill-btn" data-fill="filled">‚¨õ Filled</button>
                    </div>
                    
                    <h4>Mode</h4>
                    <div class="shape-mode-toggle">
                        <button id="shapeModeToggle" class="shape-mode-btn" title="Click to cycle through drawing modes">
                            <span id="shapeModeIcon">üìê</span>
                            <span id="shapeModeText">Corner</span>
                        </button>
                    </div>
                    
                    <div id="shapeThickness" class="thickness-section">
                        <h4>Stroke Thickness</h4>
                        <label>Width: <span id="shapeThicknessDisplay">1</span>px</label>
                        <input type="range" id="shapeThicknessSlider" min="1" max="50" value="1">
                        
                        <label>Position:</label>
                        <div class="thickness-style">
                            <button id="outsideStyle" class="style-btn active" data-style="outside">‚ä° Out</button>
                            <button id="insideStyle" class="style-btn" data-style="inside">‚äû In</button>
                            <button id="centeredStyle" class="style-btn" data-style="centered">‚äü Center</button>
                        </div>
                    </div>
                </div>

                <div class="tool-section" id="polygonSettings" style="display: none;">
                    <h3>Polygon Color</h3>
                    <div class="color-picker">
                        <button id="polygonBlackColor" class="color-btn active" data-color="black">‚¨õ Black</button>
                        <button id="polygonWhiteColor" class="color-btn" data-color="white">‚¨ú White</button>
                    </div>
                    
                    <h4>Sides</h4>
                    <label>Count: <span id="polygonSidesDisplay">6</span> sides</label>
                    <input type="range" id="polygonSides" min="3" max="20" value="6" step="1">
                    
                    <h4>Fill Style</h4>
                    <div class="fill-style">
                        <button id="polygonOutlineOnly" class="fill-btn active" data-fill="outline">‚¨ú Outline</button>
                        <button id="polygonFilledShape" class="fill-btn" data-fill="filled">‚¨õ Filled</button>
                    </div>
                    
                    
                    <div id="polygonThickness" class="thickness-section">
                        <h4>Stroke Thickness</h4>
                        <label>Width: <span id="polygonThicknessDisplay">1</span>px</label>
                        <input type="range" id="polygonThicknessSlider" min="1" max="50" value="1">
                    </div>
                </div>

                <div class="tool-section" id="textSettings" style="display: none;">
                    <h3>Text Settings</h3>
                    <div class="text-controls">
                        <label>Text:</label>
                        <textarea id="textInput" placeholder="Enter text... (use Enter for new lines)" maxlength="500" rows="3"></textarea>
                        
                        <div class="emoji-section">
                            <div id="emojiPicker" class="emoji-picker">
                                <div class="emoji-categories">
                                    <button class="emoji-cat-btn active" data-category="food">üçï</button>
                                    <button class="emoji-cat-btn" data-category="faces">üòÄ</button>
                                    <button class="emoji-cat-btn" data-category="nature">üå±</button>
                                    <button class="emoji-cat-btn" data-category="monsters">üëæ</button>
                                    <button class="emoji-cat-btn" data-category="activities">‚öΩ</button>
                                    <button class="emoji-cat-btn" data-category="travel">üöó</button>
                                    <button class="emoji-cat-btn" data-category="objects">üí°</button>
                                    <button class="emoji-cat-btn" data-category="symbols">‚ù§Ô∏è</button>
                                </div>
                                <div id="emojiGrid" class="emoji-grid">
                                    <!-- Emojis will be populated dynamically -->
                                </div>
                            </div>
                        </div>
                        
                        <label>Font:</label>
                        <select id="fontFamily">
                            <!-- System fonts will be populated dynamically -->
                        </select>
                        
                        <label>Size: <span id="fontSizeDisplay">48</span>px</label>
                        <input type="range" id="fontSize" min="4" max="100" value="48" step="1">
                        
                        <label>Style:</label>
                        <div class="text-style">
                            <button id="boldToggle" class="text-style-btn" data-style="bold">B Bold</button>
                            <button id="italicToggle" class="text-style-btn" data-style="italic">I Italic</button>
                        </div>
                        
                        <label>Color:</label>
                        <div class="color-picker">
                            <button id="textBlackColor" class="color-btn active" data-color="black">‚¨õ Black</button>
                            <button id="textWhiteColor" class="color-btn" data-color="white">‚¨ú White</button>
                        </div>
                        
                        <div class="emoji-adjustments">
                            <label>Emoji mode</label>
                            <button id="emojiDitheringToggle" class="emoji-dither-btn active">üîç Edge Detection</button>
                            
                            <div id="emojiBrightnessContainer">
                                <label>Emoji Brightness: <span id="emojiBrightnessDisplay">-20</span></label>
                                <input type="range" id="emojiBrightness" min="-100" max="100" value="-20" step="1">
                            </div>
                            
                            <div id="ditheringOptionsContainer" style="display: none;">
                                <label>Emoji Contrast: <span id="emojiContrastDisplay">100</span>%</label>
                                <input type="range" id="emojiContrast" min="50" max="200" value="100" step="1">
                                
                                <label>Dithering Type:</label>
                                <select id="ditheringTypeSelect">
                                    <option value="floyd-steinberg">Floyd-Steinberg</option>
                                    <option value="atkinson">Atkinson</option>
                                    <option value="bilayer">Bilayer</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>

                                <div class="tool-section">
                    <div class="mirror-transform-header">
                        <button id="mirrorTransformToggle" class="collapsible-btn">ü™û Mirror & Transform</button>
                    </div>
                    <div id="mirrorTransformSettings" class="frame-controls" style="display: none;">
                        <div class="mirror-tools">
                            <h4>Mirror Drawing</h4>
                            <div class="mirror-controls">
                                <button id="mirrorHorizontal" class="toggle-btn">‚ÜîÔ∏è Horizontal</button>
                                <button id="mirrorVertical" class="toggle-btn">‚ÜïÔ∏è Vertical</button>
                            </div>
                        </div>
                        
                        <div class="transform-tools">
                            <h4>Canvas Transform</h4>
                            <div class="transform-grid">
                                <button class="transform-btn" id="flipHorizontal" title="Flip Canvas Horizontally">‚ÜîÔ∏è Flip H</button>
                                <button class="transform-btn" id="flipVertical" title="Flip Canvas Vertically">‚ÜïÔ∏è Flip V</button>
                                <button class="transform-btn" id="rotateLeft" title="Rotate Canvas 90¬∞ Left">‚Ü∫ Rotate L</button>
                                <button class="transform-btn" id="rotateRight" title="Rotate Canvas 90¬∞ Right">‚Üª Rotate R</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="tool-section">
                    <div class="animation-header">
                        <button id="animationToggle" class="collapsible-btn">üé¨ Animation</button>
                    </div>
                    <div id="animationSettings" class="frame-controls" style="display: none;">
                        <div class="frame-info">
                            Frame: <span id="currentFrame">1</span> / <span id="totalFrames">1</span>
                        </div>
                        <div class="frame-buttons">
                            <button id="prevFrame" disabled>‚¨ÖÔ∏è</button>
                            <button id="nextFrame" disabled>‚û°Ô∏è</button>
                            <button id="addFrame">‚ûï</button>
                            <button id="copyFrame">üìã</button>
                            <button id="deleteFrame" disabled>üóëÔ∏è</button>
                        </div>
                        <div class="animation-controls">
                            <button id="playBtn">‚ñ∂Ô∏è Play</button>
                            <label>Speed: <span id="frameRateDisplay">5</span> FPS</label>
                            <input type="range" id="frameRate" min="0.1" max="30" value="5" step="0.1">
                            
                            <div class="animation-mode">
                                <label>Mode:</label>
                                <button id="cycleMode" class="mode-btn active" data-mode="cycle">üîÑ Cycle</button>
                                <button id="boomerangMode" class="mode-btn" data-mode="boomerang">‚ÜîÔ∏è Boomerang</button>
                            </div>
                        </div>
                        <div class="onion-skin">
                            <button id="onionSkinToggle" class="toggle-btn">üëª Onion Skin</button>
                            <div id="onionOpacityContainer" style="display: none;">
                                <label>Opacity: <span id="onionOpacityDisplay">30</span>%</label>
                                <input type="range" id="onionOpacity" min="10" max="80" value="30">
                                <div class="onion-mode-controls" style="margin-top: 8px;">
                                    <label style="font-size: 12px; color: #333; margin-bottom: 4px; display: block;">Drawing Style:</label>
                                    <button id="onionModeBlackOnWhite" class="mode-btn active" data-mode="blackOnWhite">Black on White</button>
                                    <button id="onionModeWhiteOnBlack" class="mode-btn" data-mode="whiteOnBlack">White on Black</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Main Canvas Area -->
            <main class="canvas-area">
                <div class="canvas-container">
                    <div class="canvas-wrapper">
                        <canvas id="backgroundCanvas" class="canvas-layer"></canvas>
                        <canvas id="onionCanvas" class="canvas-layer"></canvas>
                        <canvas id="drawingCanvas" class="canvas-layer"></canvas>
                        <canvas id="overlayCanvas" class="canvas-layer"></canvas>
                    </div>
                </div>
                
                <div class="canvas-controls">
                    <div class="zoom-controls">
                        <button id="zoomOut">üîç-</button>
                        <span id="zoomLevel">400%</span>
                        <button id="zoomIn">üîç+</button>
                        <button id="fitToScreen">Fit</button>
                        <button id="centerCanvas">Center</button>
                    </div>
                    <div class="grid-controls">
                        <label>
                            <input type="checkbox" id="pixelGrid"> Show Grid
                        </label>
                        <label>
                            <input type="checkbox" id="layersEnabled"> Layers
                        </label>
                    </div>
                    <div class="canvas-info">
                        <span id="canvasInfo">144√ó168</span>
                        <span id="mousePos">0, 0</span>
                    </div>
                </div>
            </main>

            <!-- Right Sidebar Toggle -->
            <button class="sidebar-toggle right-toggle" id="rightToggle" title="Toggle Export Panel">
                <span class="arrow">‚ñ∂</span>
            </button>

            <!-- Right Sidebar - Export -->
            <aside class="export-panel" id="exportPanel">
                <div class="tool-section">
                    <h3>Export</h3>
                    <div class="export-options">
                        <label>Format:</label>
                        <select id="exportFormat">
                            <option value="hpp">HPP (C++)</option>
                            <option value="animation">Animation HPP</option>
                            <option value="layers">Individual Layers HPP</option>
                            <option value="png">PNG Image</option>
                        </select>
                    </div>
                    <div class="export-options">
                        <label>Name:</label>
                        <input type="text" id="assetName" class="iphone-input" placeholder="my_image" value="my_image" maxlength="50">
                        <div id="nameWarning" class="name-warning" style="display: none;">
                            ‚ö†Ô∏è Invalid characters will be replaced with underscores
                        </div>
                    </div>
                    <div class="export-spacing"></div>
                    <button id="exportBtn" class="export-btn">üì§ Export</button>
                </div>

                <div class="tool-section">
                    <h3>Frame List</h3>
                    <div id="frameList" class="frame-thumbnails">
                        <div class="frame-thumb active" data-frame="0">
                            <canvas class="thumb-canvas"></canvas>
                            <span class="frame-label">Frame 1</span>
                        </div>
                    </div>
                </div>

                <div class="tool-section">
                    <h3>Code Output</h3>
                    <textarea id="codeOutput" readonly placeholder="Generated code will appear here..."></textarea>
                    <button id="copyCodeBtn" class="export-btn">üìã Copy Code</button>
                </div>
            </aside>
        </div>
    </div>

    <!-- Hidden file input -->
    <input type="file" id="fileInput" accept=".json,.hpp,.png,.gif" style="display: none;">

    <!-- Help Modal -->
    <div id="helpModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üé® Drawing Editor Help</h2>
                <span class="close" id="closeHelp">&times;</span>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <h3>üîß Tools</h3>
                    <div class="shortcut-grid">
                        <span class="key">P</span><span>Pen Tool</span>
                        <span class="key">C</span><span>Circle Tool</span>
                        <span class="key">R</span><span>Rectangle Tool</span>
                        <span class="key">F</span><span>Fill Tool</span>
                        <span class="key">H</span><span>Hand Tool (Pan)</span>
                        <span class="key">O</span><span>Select Tool</span>
                        <span class="key">B</span><span>Black Color</span>
                        <span class="key">W</span><span>White Color</span>
                    </div>
                </div>
                
                <div class="help-section">
                    <h3>üìÅ File Operations</h3>
                    <div class="shortcut-grid">
                        <span class="key">Ctrl+N</span><span>New Drawing</span>
                        <span class="key">Ctrl+S</span><span>Save Drawing</span>
                        <span class="key">Ctrl+O</span><span>Open Drawing</span>
                        <span class="key">Del</span><span>Clear Canvas</span>
                    </div>
                </div>
                
                <div class="help-section">
                    <h3>‚úÇÔ∏è Edit Operations</h3>
                    <div class="shortcut-grid">
                        <span class="key">Ctrl+C</span><span>Copy Selection</span>
                        <span class="key">Ctrl+V</span><span>Paste Selection</span>
                        <span class="key">Ctrl+X</span><span>Cut Selection</span>
                    </div>
                </div>
                
                <div class="help-section">
                    <h3>üé¨ Animation</h3>
                    <div class="shortcut-grid">
                        <span class="key">‚Üê</span><span>Previous Frame</span>
                        <span class="key">‚Üí</span><span>Next Frame</span>
                        <span class="key">Space</span><span>Play/Pause Animation</span>
                    </div>
                </div>
                
                <div class="help-section">
                    <h3>üîç View Controls</h3>
                    <div class="shortcut-grid">
                        <span class="key">+</span><span>Zoom In</span>
                        <span class="key">-</span><span>Zoom Out</span>
                        <span class="key">0</span><span>Fit to Screen</span>
                        <span class="key">.</span><span>Center Canvas</span>
                        <span class="key">1-9</span><span>Set Brush Size</span>
                        <span class="key">Middle Click</span><span>Pan/Drag Canvas</span>
                        <span class="key">?</span><span>Show/Hide Help</span>
                    </div>
                </div>
                
                <div class="help-section">
                    <h3>üí° Tips</h3>
                    <ul>
                        <li>Hold Shift while drawing to draw straight lines</li>
                        <li>Circle tool: Normal = ellipse (corner to corner), Shift = circle (center to radius)</li>
                        <li>Rectangle tool: Normal = rectangle (corner to corner), Shift = square (center outward)</li>
                        <li>Use onion skinning to see previous/next frames</li>
                        <li>Export as Animation HPP for Kywy displays</li>
                        <li>Use selection tool to copy/move parts of your drawing</li>
                        <li>144√ó168 is the native Kywy display resolution</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Importer Modal -->
    <div id="imageImportModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Import Image</h3>
                <span class="close" onclick="document.getElementById('imageImportModal').style.display='none'">&times;</span>
            </div>
            <div class="modal-body">
                <div class="import-section">
                    <h4>Upload Image</h4>
                    <input type="file" id="importImageInput" accept="image/*">
                    <div id="importOriginalImage"></div>
                </div>

                <div class="import-section">
                    <h4>Settings</h4>
                    
                    <div class="setting-row">
                        <label for="importResize">Resize:</label>
                        <select id="importResize">
                            <option value="">Keep original size</option>
                            <option value="16x16">16x16</option>
                            <option value="32x32">32x32</option>
                            <option value="64x64">64x64</option>
                            <option value="128x128">128x128</option>
                            <option value="144x168">144x168</option>
                            <option value="custom">Custom size</option>
                        </select>
                        <div id="importCustomSize" style="display: none;">
                            <input type="number" id="importCustomWidth" placeholder="Width" min="1" max="1000">
                            x
                            <input type="number" id="importCustomHeight" placeholder="Height" min="1" max="1000">
                        </div>
                    </div>

                    <div class="setting-row">
                        <label>
                            <input type="checkbox" id="importInvert">
                            Invert colors
                        </label>
                        <label>
                            <input type="checkbox" id="importEdgeDetection">
                            Edge detection
                        </label>
                    </div>

                    <div class="setting-row">
                        <label for="importDithering">Dithering:</label>
                        <select id="importDithering">
                            <option value="none">None</option>
                            <option value="floyd-steinberg">Floyd-Steinberg</option>
                            <option value="atkinson">Atkinson</option>
                            <option value="ordered">Ordered (Bayer)</option>
                        </select>
                    </div>

                    <div class="setting-row">
                        <label for="importContrast">Contrast:</label>
                        <input type="range" id="importContrast" min="-100" max="100" value="0" step="1">
                        <span id="importContrastValue">0</span>
                    </div>

                    <div class="setting-row">
                        <label for="importBrightness">Brightness:</label>
                        <input type="range" id="importBrightness" min="-100" max="100" value="0" step="1">
                        <span id="importBrightnessValue">0</span>
                    </div>

                    <div class="setting-row">
                        <label for="importThreshold">Threshold:</label>
                        <input type="range" id="importThreshold" min="0" max="255" value="128" step="1">
                        <span id="importThresholdValue">128</span>
                    </div>

                    <div class="setting-row">
                        <label for="importPosition">Position:</label>
                        <select id="importPosition">
                            <option value="center">Center</option>
                            <option value="top-left">Top Left</option>
                            <option value="top-right">Top Right</option>
                            <option value="bottom-left">Bottom Left</option>
                            <option value="bottom-right">Bottom Right</option>
                        </select>
                    </div>
                </div>

                <div class="import-section">
                    <h4>Preview</h4>
                    <div id="importProcessedImage"></div>
                </div>

                <div class="modal-footer">
                    <button id="importToCanvas" class="btn btn-primary" disabled>Import to Canvas</button>
                    <button id="importToPaste" class="btn btn-primary" disabled>Import to Paste Mode</button>
                    <button onclick="document.getElementById('imageImportModal').style.display='none'" class="btn">Cancel</button>
                </div>
            </div>
        </div>
        
        <!-- Footer Branding -->
        <footer class="app-footer">
            <div class="footer-brand">
                <div class="ks-icon-small"></div>
                <span>Powered by KOINSLOT</span>
            </div>
        </footer>
    </div>

    <!-- Copy Layer to Frames Modal -->
    <div id="copyLayerModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Copy Layer to Frames</h2>
                <span class="close" onclick="document.getElementById('copyLayerModal').style.display='none'">&times;</span>
            </div>
            <div class="modal-body">
                <p id="copyLayerModalText" style="margin-bottom: 15px; font-weight: 500;">Select frames to copy "<span id="copyLayerName"></span>" to:</p>
                
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button id="selectAllFrames" class="btn" style="flex: 1;">Select All</button>
                    <button id="deselectAllFrames" class="btn" style="flex: 1;">Deselect All</button>
                </div>
                
                <div id="frameCheckboxList" style="max-height: 300px; overflow-y: auto; border: 1px solid #ddd; border-radius: 4px; padding: 10px; background: white;">
                    <!-- Frame checkboxes will be populated here by JavaScript -->
                </div>
                
                <div class="modal-footer" style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
                    <button onclick="document.getElementById('copyLayerModal').style.display='none'" class="btn">Cancel</button>
                    <button id="confirmCopyLayer" class="btn" style="background: var(--primary-color); color: white;">Copy</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile Menu Overlay -->
    <div id="mobileMenuOverlay" class="mobile-overlay"></div>

    <!-- Mobile Popup Menus -->
    <div id="mobile-left-menu" class="mobile-popup mobile-left">
        <div class="mobile-menu-header">
            <h3>üõ†Ô∏è Tools & Settings</h3>
            <button class="mobile-close-btn">‚úï</button>
        </div>
        <div class="mobile-menu-content">
            <!-- Left sidebar content (tools, colors, etc.) will be dynamically populated -->
            <div class="mobile-section">
                <h4>Drawing Tools</h4>
                <!-- Tools content -->
            </div>
            <div class="mobile-section">
                <h4>Colors</h4>
                <!-- Color picker content -->
            </div>
            <div class="mobile-section">
                <h4>Brush Settings</h4>
                <!-- Brush settings content -->
            </div>
        </div>
    </div>

    <div id="mobile-right-menu" class="mobile-popup mobile-right">
        <div class="mobile-menu-header">
            <h3>üì§ Export & Actions</h3>
            <button class="mobile-close-btn">‚úï</button>
        </div>
        <div class="mobile-menu-content">
            <!-- Right sidebar content (export, frames, etc.) will be dynamically populated -->
            <div class="mobile-section">
                <h4>Animation</h4>
                <!-- Frame controls content -->
            </div>
            <div class="mobile-section">
                <h4>Export Options</h4>
                <!-- Export controls content -->
            </div>
            <div class="mobile-section">
                <h4>Canvas Tools</h4>
                <!-- Canvas transform tools -->
            </div>
        </div>
        </div>
    
    <!-- Layers Panel (bottom of screen) -->
    <div class="layers-panel" id="layersPanel" style="display: none;">
        <div class="layers-header">
            <h3>üìö Layers (BETA)</h3>
            <div class="layers-actions">
                <button id="addLayer" class="layer-btn" title="Add Layer">‚ûï Add</button>
                <button id="deleteLayer" class="layer-btn" title="Delete Layer">üóëÔ∏è</button>
                <button id="mergeDown" class="layer-btn" title="Merge with Layer Below">‚¨áÔ∏è Merge</button>
                <button id="copyLayerToFrames" class="layer-btn" title="Copy Layer to Other Frames">üìã Copy to Frames</button>
            </div>
        </div>
        <div class="layers-list" id="layersList">
            <!-- Layers will be added here dynamically -->
        </div>
    </div>
    
    <!-- Mobile Bottom Bar -->
    <div class="mobile-bottom-bar">
        <div class="mobile-bottom-controls">
            <!-- Grid Toggle -->
            <button class="mobile-control-btn" id="mobileGridBtn" title="Toggle Grid">
                <span>üìê</span>
            </button>
            
            <!-- Zoom Controls -->
            <div class="mobile-zoom-group">
                <button class="mobile-control-btn" id="mobileZoomOut" title="Zoom Out">‚àí</button>
                <span class="mobile-zoom-display" id="mobileZoomDisplay">100%</span>
                <button class="mobile-control-btn" id="mobileZoomIn" title="Zoom In">+</button>
            </div>
            
            <!-- View Controls -->
            <button class="mobile-control-btn" id="mobileFitBtn" title="Fit to Screen">‚§¢</button>
            <button class="mobile-control-btn" id="mobileCenterBtn" title="Center Canvas">üéØ</button>
            
            <!-- Mouse Position -->
            <span class="mobile-mouse-pos" id="mobileMousePos">0, 0</span>
        </div>
    </div>
    
    <!-- Tool Settings Popup -->
    <div class="tool-settings-popup" id="toolSettingsPopup" style="display: none;">
        <div class="tool-settings-header">
            <h3>Tool Settings</h3>
            <button class="close-popup-btn" id="closeToolSettings">√ó</button>
        </div>
        <div class="tool-settings-content" id="toolSettingsContent">
            <!-- Content will be populated dynamically based on selected tool -->
        </div>
    </div>

    <script src="theme-switcher.js"></script>
    <script src="drawing-editor.js"></script>
</body>
</html>
